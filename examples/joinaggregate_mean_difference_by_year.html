<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />

    <link rel="shortcut icon" href="https://vega.github.io/favicon.ico" />

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Calculate Difference from Annual Average | Vega-Lite</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Calculate Difference from Annual Average" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bar graph showing the best films for the year they were produced, where best is defined by at least 2.5 points above average for that year. The red point shows the average rating for a film in that year, and the bar is the rating that the film recieved." />
<meta property="og:description" content="Bar graph showing the best films for the year they were produced, where best is defined by at least 2.5 points above average for that year. The red point shows the average rating for a film in that year, and the bar is the rating that the film recieved." />
<meta property="og:site_name" content="Vega-Lite" />
<meta property="og:image" content="/vega-lite/examples/joinaggregate_mean_difference_by_year.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/vega-lite/examples/joinaggregate_mean_difference_by_year.png" />
<meta property="twitter:title" content="Calculate Difference from Annual Average" />
<meta name="twitter:site" content="@vega_vis" />
<script type="application/ld+json">
{"headline":"Calculate Difference from Annual Average","url":"/vega-lite/examples/joinaggregate_mean_difference_by_year.html","@type":"WebPage","image":"/vega-lite/examples/joinaggregate_mean_difference_by_year.png","description":"Bar graph showing the best films for the year they were produced, where best is defined by at least 2.5 points above average for that year. The red point shows the average rating for a film in that year, and the bar is the rating that the film recieved.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <script>
      const BASEURL = window.location.origin + '/vega-lite';
    </script>

    <link rel="stylesheet" href="/vega-lite/static/github.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/octicons@4.4.0/build/font/octicons.min.css" />
    <link rel="stylesheet" href="/vega-lite/static/main.css" />
  </head>
  <body>
    <div class="fill">
  <header>
    <nav class="page-centered">
      <div class="dropdown">
        <a class="vl-title" href="/vega-lite/">Vega-Lite</a>
        <div class="dropdown-content">
          <a href="https://vega.github.io/vega/">Vega</a>
          <a href="https://altair-viz.github.io/">Altair</a>
        </div>
      </div>
      <div class="vl-links">
        <div class="primary-links">
          <a href="/vega-lite/examples/" class="active">Examples</a>
          <a href="/vega-lite/tutorials/getting_started.html" >Tutorials</a>
          <a href="/vega-lite/docs/" >Documentation</a>
          <a href="/vega-lite/usage/embed.html" >Usage</a>
          <a href="/vega-lite/ecosystem.html" >Ecosystem</a>
        </div>
        <div class="secondary-links">
          <a href="https://www.github.com/vega/vega-lite">GitHub</a>
          <a href="https://vega.github.io/editor/#/custom/vega-lite">Try Online</a>
        </div>
      </div>
    </nav>
  </header>
  <section class="examples">
    <div class="page-centered page-content">
  
    <h1>Calculate Difference from Annual Average</h1>
  
  <p>Bar graph showing the best films for the year they were produced, where best is defined by at least 2.5 points above average for that year. The red point shows the average rating for a film in that year, and the bar is the rating that the film recieved.</p>

<div id="joinaggregate_mean_difference_by_year"></div>

<script>
    window.onload = function() {
      const spec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "description": "Bar graph showing the best films for the year they were produced, where best is defined by at least 2.5 points above average for that year. The red point shows the average rating for a film in that year, and the bar is the rating that the film recieved.",
  "data": {
    "url": "data/movies.json"
  },
  "transform": [
      {"filter": "datum['IMDB Rating'] != null"},
      {"timeUnit": "year", "field": "Release Date", "as": "year"},
      {
        "joinaggregate": [{
          "op": "mean",
          "field": "IMDB Rating",
          "as": "AverageYearRating"
        }],
        "groupby": [
          "year"
        ]
      },
      {
        "filter": "(datum['IMDB Rating'] - datum.AverageYearRating) > 2.5"
      }
  ],
  "layer": [{
      "mark": {"type": "bar", "clip": true},
      "encoding": {
        "x": {
          "field": "IMDB Rating",
          "type": "quantitative",
          "title": "IMDB Rating"
        },
        "y": {
          "field": "Title",
          "type": "ordinal"
        }
      }
    },
    {
      "mark": "tick",
      "encoding": {
        "x": {
          "field": "AverageYearRating",
          "type": "quantitative"
        },
        "y": {
          "field": "Title",
          "type": "ordinal"
        },
        "color": {"value": "red"}
      }
    }
  ]
}
;

      embedExample('#joinaggregate_mean_difference_by_year', spec, false);
  }
</script>

<p><a href="https://vega.github.io/editor/#/examples/vega-lite/joinaggregate_mean_difference_by_year">
  View this example in the online editor
</a></p>

<h3 id="spec">Vega-Lite JSON Specification</h3>

<pre class="example-spec"><code class="language-json">{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "description": "Bar graph showing the best films for the year they were produced, where best is defined by at least 2.5 points above average for that year. The red point shows the average rating for a film in that year, and the bar is the rating that the film recieved.",
  "data": {
    "url": "data/movies.json"
  },
  "transform": [
      {"filter": "datum['IMDB Rating'] != null"},
      {"timeUnit": "year", "field": "Release Date", "as": "year"},
      {
        "joinaggregate": [{
          "op": "mean",
          "field": "IMDB Rating",
          "as": "AverageYearRating"
        }],
        "groupby": [
          "year"
        ]
      },
      {
        "filter": "(datum['IMDB Rating'] - datum.AverageYearRating) &gt; 2.5"
      }
  ],
  "layer": [{
      "mark": {"type": "bar", "clip": true},
      "encoding": {
        "x": {
          "field": "IMDB Rating",
          "type": "quantitative",
          "title": "IMDB Rating"
        },
        "y": {
          "field": "Title",
          "type": "ordinal"
        }
      }
    },
    {
      "mark": "tick",
      "encoding": {
        "x": {
          "field": "AverageYearRating",
          "type": "quantitative"
        },
        "y": {
          "field": "Title",
          "type": "ordinal"
        },
        "color": {"value": "red"}
      }
    }
  ]
}

</code></pre>


</div>

  </section>
</div>

<footer>
  <div class="page-centered">
   <span class="edit-page">
      <a href="https://github.com/vega/vega-lite/edit/master/site/_data/examples.json">Edit this page</a> and submit a pull request!
    </span>

    <a href="http://idl.cs.washington.edu" title="UW Interactive Data Lab" class="idl-logo"><img src="/vega-lite/static/idl-logo.png"/></a>
  </div>
</footer>

    <script src="/vega-lite/static/bundle.js"></script>
    <script>
      // Google Analytics
      (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        (i[r] =
          i[r] ||
          function() {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-44428446-6', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
